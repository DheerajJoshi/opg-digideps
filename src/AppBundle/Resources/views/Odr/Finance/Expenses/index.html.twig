{% embed 'AppBundle:Layouts:odr_left_nav.html.twig' %}
    {% set translationDomain = "odr-expenses" %}
    {% trans_default_domain translationDomain %}

    {% set clientTrans = {'%client%': odr.client.firstname} %}

    {% block pageTitle %}{{ 'page.htmlTitle' | trans }}{% endblock %}
    {% block title %}
        {{ 'page.pageSectionTitle' | trans(clientTrans) }}
    {% endblock %}

    {% block leftcontent %}
        {% include 'AppBundle:Odr/Finance:left-nav.html.twig' %}
    {% endblock %}

    {% block maincontent %}

        <h3 class="heading-small">
            {{ 'page.pageDescription' | trans({
                '%client%': odr.client.firstname,
                '%linkStart%': '<a href="https://www.gov.uk/government/publications/deputy-guidance-how-to-carry-out-your-duties" target="_blank">',
                '%linkEnd%': '</a>',
            }, translationDomain )  | raw }}</h3>

        {{ form_start(form, {attr: {novalidate: 'novalidate' }}) }}

        <div class="form-section">
            {{ form_checkbox_group(form.paidForAnything, 'form.paidForAnything', {
                'fieldSetClass' : 'inline paid-anything',
                'legendClass' : 'form-label',
                'legendText' : 'form.paidForAnything.label' | trans({'%client%': odr.client.firstname}, translationDomain),
                'items': [
                {'labelClass': 'block-label', 'elementClass': '' },
                {'labelClass': 'block-label', 'elementClass': '' }
                ]
            }) }}
            <div id="expenses-wrapper">
                <div class="expense-rows">
                    {% for singleExpenseForm in form.expenses %}
                        <fieldset class="expense-row {{ loop.last ? 'expense-row-template hidden' : '' }}">
                            {{ form_input(singleExpenseForm.explanation, 'form.expenses.explanation', {
                                'formGroupClass': 'explanation',
                            }) }}
                            {{ form_input(singleExpenseForm.amount, 'form.expenses.amount', {
                                'inputClass': 'expense-amount',
                                'formGroupClass': 'amount',
                            }) }}
                           <div class="remove">
                             <a href="#" class="expense_remove_link">Remove</a>
                           </div>
                        </fieldset>
                    {% endfor %}
                </div>
                <div class="form-group">
                    <a href="#" id="expenses-add-link" class="add-expense-link">
                        {{ 'form.expenses.addAnother.label' |trans }}
                    </a>
                    <div class="total">Total: Â£<span class="expense_total">0</span></div>
                </div>
             </div>
        </div>

        <div class="form-section">
            {{ form_checkbox_group(form.planningToClaimExpenses, 'planningToClaimExpenses', {
                'fieldSetClass' : 'inline planning-claim-expenses',
                'legendClass' : 'form-label',
                'legendText' : 'form.planningToClaimExpenses.label' | trans({'%client%': odr.client.firstname}, translationDomain),
                'items': [
                {'labelClass': 'block-label', 'elementClass': '' },
                {'labelClass': 'block-label', 'elementClass': '' }
                ]
            }) }}
            <div id="planning-claim-expenses-textarea">
                {{ form_input(form.planningToClaimExpensesDetails, 'form.planningToClaimExpensesDetails', {
                    'labelClass': 'required',
                    'labelParameters': { '%client%': odr.client.firstname },
                    'inputClass': 'expanding'
                }) }}
            </div>
        </div>

        {% include 'AppBundle:Components/ButtonBar:_start.html.twig' %}
        {{ form_submit(form.save,'form.save') }}
        {% include 'AppBundle:Components/ButtonBar:_end.html.twig' %}

        {{ form_end(form) }}

        <script>
            $(document).ready(function () {
                new opg.RadioHide({
                    radio: '.paid-anything input[type=radio]',
                    content: '#expenses-wrapper',
                    showWithValue: 'yes'
                });

                new opg.RadioHide({
                    radio: '.planning-claim-expenses input[type=radio]',
                    content: '#planning-claim-expenses-textarea',
                    showWithValue: 'yes'
                });

                // total calculator
                var totalCalculator = new opg.TotalCalculator({
                    'wrapperSelector': '#expenses-wrapper',
                    'amountSelector':  '.expense-amount',
                    'totalSelector' : '.expense_total',
                });

                // add expense link
                $('#expenses-add-link').click(function(e) {
                    e.preventDefault();
                    var expenseRowTemplate = $('#expenses-wrapper .expense-row-template')
                            .clone()
                            .removeClass('expense-row-template')
                            .removeClass('hidden');
                    $('#expenses-wrapper .expense-rows').append(expenseRowTemplate);
                    totalCalculator.updateTotal();
                });

                // remove link
                $('#expenses-wrapper').on('click', '.expense_remove_link', function(e) {
                    e.preventDefault();
                    $(e.target).parents('.expense-row').remove();
                    totalCalculator.updateTotal();
                });

            });
        </script>

    {% endblock %}

    {% block pageBodyFooterNav %}
        {% include 'AppBundle:Components:nextprevious.html.twig' with {
        'nextLink': path("odr-bank-accounts" , {'odrId': odr.id }),
        'nextLabel': 'Accounts',
        } %}
    {% endblock %}


{% endembed %}
