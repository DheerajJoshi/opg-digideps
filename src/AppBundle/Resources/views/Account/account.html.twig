{% embed 'AppBundle:Components/Page:page-accounts.html.twig' with {
activeTab: "tab-accounts"
} %}
    {% set translationDomain = "report-account" %}
    {% trans_default_domain translationDomain %}

    {% set accordionLinks = accordionLinks({
    clickedPanel: actionParam,
    bothOpenHref: "money-both",
    allClosedHref: "list",
    firstPanelHref: "money-in",
    secondPanelHref: "money-out",
    onlyOneATime: true
    }) %}

    {% set breadCrumb = [
    {
    'label': 'Accounts' | trans,
    'href': path('accounts', {reportId: report.id}),
    },
    {
    'label': account.bank
    }
    ] %}

    {% set tabClasses = [] %}

    {% block pageTitle %}{{ 'page.htmlTitle' | trans({'%accountName%': account.bank}) }} {% endblock %}
    {% block title %}{{ 'page.pageSectionTitle' | trans }} {% endblock %}    
    {% block contentClass %}{{ parent() }} report-money-input js-report-money-input{% endblock %}

    {% block pageBody %}

        {% include 'AppBundle:Components/Navigation:_bread-crumb.html.twig' with {
        breadCrumb: breadCrumb
        } %}

        {% include 'AppBundle:Account:_account-header.html.twig' with {
        transDomain: translationDomain,
        hideComponent: (formEditShow),
        showAccountOpeningDateExplanation: false
        } %}

        {% block validationSummary %}
            {{ form_errors_list(form) }}
            {{ form_errors_list(closingBalanceForm) }}
            {{ form_errors_list(formEdit) }}
        {% endblock %}

        {% if closingBalanceFormShow  %}
            {% include 'AppBundle:Account:_closing_balance_form.html.twig' with {
            closingBalanceForm: closingBalanceForm,
            hideForm: (formEditShow)
            } %}
        {% endif %}

        {% include 'AppBundle:Account:_account_form_edit.html.twig' with {
        form: formEdit,
        formClass: 'report-form in-page-form',
        hideForm: (not formEditShow)
        } %}

        {% include 'AppBundle:Components/Page:_page-section-warning.html.twig' with {
        transDomain: translationDomain,
        pageSectionWarning: 'page.pageSectionWarning'
        } %}


        {{ form_start(form, {attr: {novalidate: 'novalidate', class: 'in-page-form', id: "transactions-form" }}) }}

        {{ form_row(form.id) }}

        <div class="account-transactions account-transactions__header">
            <dl class="account-transactions__total-balance">
                <dt class="account-transactions__total-balance-label">{{ 'page.totalBalance' | trans }}</dt>
                <dd class="account-transactions__total-balance-total">
                    {{ 'page.currencySymbol' | trans }}{{ account.moneyTotal | number_format(2, '.', ',') }}</dd>
            </dl>
        </div>

        <div class="account-transactions">

            {% include 'AppBundle:Account:_accountTransaction.html.twig' with {
            legend: 'moneyIn.legend' | trans,
            openPanel: accordionLinks.first.open or not form.moneyIn.vars.valid,
            href: 'moneyIn',
            link: path('account', {action: accordionLinks.first.href, reportId: report.id, accountId: account.id}),
            elements: form.moneyIn,
            section: 'moneyIn',
            transactionTotal: account.moneyInTotal,
            submitButton: form.saveMoneyIn
            } %}


            {% include 'AppBundle:Account:_accountTransaction.html.twig' with {
            openPanel: accordionLinks.second.open or not form.moneyOut.vars.valid,
            href: 'moneyOut',
            link: path('account', {action: accordionLinks.second.href, reportId: report.id, accountId: account.id}),
            elements: form.moneyOut,
            section: 'moneyOut',
            transactionTotal: account.moneyOutTotal,
            submitButton: form.saveMoneyOut
            } %}

        </div>

        <div class="account-transactions account-transactions__footer">
            <ul class="account-transactions__total-balance">
                <li class="account-transactions__total-balance-label">{{ 'page.totalBalance' | trans }}</li>
                <li class="account-transactions__total-balance-total behat-region-money-totals">
                    {{ 'page.currencySymbol' | trans }}{{ account.moneyTotal | number_format(2, '.', ',') }}</li>
            </ul>
        </div>

        {{ form_end(form) }}

    <script type="text/javascript">
        var transactionHasChanged = false;
        var message = "{{ 'leaveWarning' | trans | raw }}";

        $( document ).ready(function() {
            $(".account-transactions").on("keyup input paste", ".form-row input.form-control__number", function(){
                transactionHasChanged = true;
            });
            $('form#transactions-form').on('submit', function(e) {
                transactionHasChanged = false;
                return true;
            });

            $(window).bind("beforeunload",function(event) {
                if (transactionHasChanged) return message;
            });

            new opg.GrandTotal({
                moneyIn: '#moneyIn .transaction-total',
                moneyOut: '#moneyOut .transaction-total',
                grandTotal: '.account-transactions__total-balance-total',
                startBalance: {{ account.openingBalance}},
                currency: '{{ 'page.currencySymbol' | trans }}'
            });
        });
    </script>

    {% endblock %}
    
{% endembed %}
