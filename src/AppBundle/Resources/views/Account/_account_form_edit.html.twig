{% set translationDomain = "report-accounts" %}
{% set formId = "account_edit_form" %}
{% trans_default_domain translationDomain %}

<div class="account__edit{% if hideForm %} visuallyhidden{% endif %}">
    {{ form_start(form, {attr: {novalidate: 'novalidate', class: 'report-form in-page-form', id: formId } }) }}

    {# main form #}
    {% include 'AppBundle:Components/Page:_sub-section-title.html.twig' with {
    transDomain: translationDomain,
    subSectionTitle: 'form.edit.accountDetails.subSectionTitle'
    } %}

    {# start common form elements #}
    
    {{ form_input(form.bank, 'form.accountDetails.controls.bank') }}
    {{ form_input(form.accountNumber, 'form.accountDetails.controls.accountNumber') }}
    {{ form_sort_code(form.sortCode, 'form.accountDetails.controls.sortCode') }}

    {# opening balance part #}
    {% include 'AppBundle:Components/Page:_sub-section-title.html.twig' with {
    transDomain: translationDomain,
    subSectionTitle: 'form.edit.openingBalance.subSectionTitle'
    } %}

    {% include 'AppBundle:Components/Page:_sub-section-description.html.twig' with {
      transDomain: translationDomain,
      subSectionDescription: 'form.openingBalance.subSectionDescription',
      transOptions: { 
        '{{ reportStartDate }}': report.StartDate | date('m/d/Y'),
        '{{ boldStart }}': '<strong style="font-weight:bold">',
        '{{ boldEnd }}': '</strong>'
      }
    } %}
    
    <div id="account_opening_date_same_wrapper" class="visuallyhidden">
      
      {% include 'AppBundle:Components/Page:_sub-section-description.html.twig' with {
      transDomain: translationDomain,
      subSectionDescription: 'Is the start date of your reporting period and the opening balance date the same ?',
    } %}
      
      {{ form_checkbox_group(form.openingDateSame, 'openingDateSameYesNo', {
          'fieldSetClass' : 'vertical',
          'legendClass' : 'form-label',
          'items': [
              {'labelClass': 'block-label', 'elementClass': '', 'description': "form.openingBalance.controls.openingDateSame.labelYes" | trans({}, translationDomain) },
              {'labelClass': 'block-label', 'elementClass': '', 'description': "form.openingBalance.controls.openingDateSame.labelNo" | trans({}, translationDomain) }
          ]
      }) }}
      
    </div>
    
    <div id="account_opening_date_not_same">
          
    {{ form_known_date(form.openingDate, 'form.openingBalance.controls.openingDate', {
        'legendParameters': {
          '{{ reportStartDate }}': report.StartDate | date('m/d/Y'),
          '{{ boldStart }}': '<strong style="font-weight:bold">',
          '{{ boldEnd }}': '</strong>'
        },
        'legendRaw': true
    }) }}
    
    {{ form_input(form.openingDateExplanation, 'form.openingBalance.controls.openingDateExplanation', { 
      'labelClass': 'required',
      'inputClass': 'expanding',
      'labelParameters': {
        '{{ reportStartDate }}': report.StartDate | date('m/d/Y'),
        '{{ boldStart }}': '<strong style="font-weight:bold">',
        '{{ boldEnd }}': '</strong>'
      },
      'labelRaw': true
    }) }}
    
    </div>
    
    {{ form_input(form.openingBalance, 'form.openingBalance.controls.openingBalance', {
    'inputPrefix' : 'form.openingBalance.controls.openingBalancePrefix.label',
    'inputClass' : 'form-control__number'
    } ) }}
    
    {# end common form elements #}

    {# closing balance part #}
    {% if form.closingDate is defined and form.closingBalance is defined %}
        
        {% include 'AppBundle:Components/Page:_sub-section-title.html.twig' with {
        transDomain: translationDomain,
        subSectionTitle: 'form.edit.closingBalance.subSectionTitle'
        } %}

        {% include 'AppBundle:Components/Page:_sub-section-description.html.twig' with {
        transDomain: translationDomain,
        subSectionDescription: 'form.edit.closingBalance.subSectionDescription'
        } %}

         {# Closing date + explanation box #}
        {{ form_known_date(form.closingDate, 'form.edit.controls.closingDate') }}
        {% if formEditClosingDateExplanationShow %}
          {{ form_input(form.closingDateExplanation, 'form.edit.controls.closingDateExplanation', { 'labelClass': 'required',inputClass: 'expanding' }) }}
        {% else %}
          {% do form.closingDateExplanation.setRendered() %}
        {% endif %}
      
      
        {# Closing balance + explanation box #}
        {{ form_input(form.closingBalance, 'form.edit.controls.closingBalance', {
        'inputPrefix' : 'form.openingBalance.controls.openingBalancePrefix.label',
        'inputClass' : 'form-control__number'
        } ) }}
        {% if formEditClosingBalanceExplanationShow %}
          {{ form_input(form.closingBalanceExplanation, 'form.edit.controls.closingBalanceExplanation', { 'labelClass': 'required', inputClass: 'expanding' }) }}
        {% else %}
          {% do form.closingBalanceExplanation.setRendered() %}
        {% endif %} 

      {% endif %}


    {% if showDeleteConfirmation == 'delete' %}

        {% include 'AppBundle:Components/Alerts:_delete-confirmation.html.twig' with
        {
        'translationDomain': translationDomain,
        componentID: 'account-delete-confirm',
        deleteMessageText: 'form.delete.legend' | trans,
        deleteButtonType: form.delete,
        deleteButtonText: 'form.edit.controls.delete' | trans,
        deleteButtonClass: '',
        cancelButtonLink: path('account', {'reportId': report.id, 'accountId': account.id, 'action':'edit'}) ~ '#account-header',
        cancelButtonText: 'form.edit.controls.cancel.label' | trans,
        cancelButtonClass: 'behat-link-delete-confirm-cancel' | trans
        } %}


    {% else %}
      {% include 'AppBundle:Components/ButtonBar:_start.html.twig' %}
      {{ form_submit(form.save,'form.edit.controls.save') }}

      {% include 'AppBundle:Components/Link:_link-button.html.twig' with {
        transDomain: translationDomain,
        linkButtonLabel: 'form.edit.controls.cancel.label',
        linkClass: 'button-link',
        linkHref: path('account', {'reportId': report.id, 'accountId': account.id})
      } %}

        {% include 'AppBundle:Components/Link:_link-button.html.twig' with {
          transDomain: translationDomain,
          linkButtonLabel: 'form.edit.controls.delete.label',
          linkClass: 'button-warning behat-link-delete-account',
          linkHref: path('account', {'reportId': report.id, 'accountId': account.id, 'action': 'delete'}) ~ '#account-delete-confirm'
        } %}
      {% include 'AppBundle:Components/ButtonBar:_end.html.twig' %}
    {% endif %}

    {{ form_end(form) }}
</div>

{# openingData toggle logic #}
 <script type="text/javascript">

      $().ready(function () {
        
        var openingDateNotSameBlock = $('#account_opening_date_not_same');
        
        // initiate JS version (hide fields)
        openingDateNotSameBlock.addClass('visuallyhidden');
        
        // show the checkbox and attach onClick event
        $('#account_opening_date_same_wrapper')
         .removeClass('visuallyhidden')
         .change(function() {
            if ("yes" === $('input[name="{{ form.openingDateSame.vars.full_name }}"]:checked', '#{{ formId }}').val()) {
              openingDateNotSameBlock.addClass('visuallyhidden');
            } else {
              openingDateNotSameBlock.removeClass('visuallyhidden');
            }
        });

      });

  </script>
