{% extends 'AppBundle:Layouts:application.html.twig' %}

{% set translationDomain = "admin-checklist" %}
{% trans_default_domain translationDomain %}

{% set page = 'checklistPage' %}
{% set checklistPage = true %}
{% set transOptions = {'%client%': report.client.firstname | e } %}

{% block htmlTitle %}{{ (page ~ '.htmlTitle') | trans }}{% endblock %}
{% block pageTitle %}{{ (page ~ '.supportTitle') | trans }}{% endblock %}
{% block pageTitleClass %}heading-large{% endblock %}

{% block supportTitleTop %}
    <span class="heading-secondary">{{ (page ~ '.pageTitle') | trans }}</span>
{% endblock %}

{# Breadcrumbs #}
{% block breadcrumbs %}
    <div class="breadcrumbs hard--bottom">
        <ol class="group">
            <li><a href="{{ path('admin_client_search') }}">Clients</a></li>
            <li><a href="{{ path('admin_client_details', {'id' : report.client.id}) }}">Client details</a></li>
        </ol>
    </div>
{% endblock %}

{% block helpline %}{% endblock %}

{% block pageContent %}

    <p class="flush--bottom">
        {{ 'client' | trans({}, 'common') }}:
        <span class="bold">{{ report.client.fullName }}</span>
    </p>
    <p>
        {{ 'courtOrderNumber' | trans({}, 'common') }}:
        <span class="bold">{{ report.client.caseNumber }}</span>
    </p>

    {{ form_start(form, {attr: {novalidate: 'novalidate', id: 'create-report-checklist-form' }}) }}


    <h3 class="heading-medium underline">{{ (page ~ '.heading.info') | trans }}</h3>

    <div class="form-section form-section--meta-cancel">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.reportingPeriodAccurate, (page ~ '.form.reportingPeriodAccurate'), {
                'fieldSetClass': 'inline'
            }) }}
        </div>
    </div>

    <div class="form-section form-section--meta-cancel">
       <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox(form.contactDetailsUptoDate, (page ~ '.form.contactDetailsUptoDate'), {
                'labelClass': 'text'
            }) }}
        </div>
    </div>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox(form.deputyFullNameAccurateInCasrec, (page ~ '.form.deputyFullNameAccurateinCasrec'), {
                'labelClass': 'text'
            }) }}
        </div>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.decisions') | trans }}</h3>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.decisionsSatisfactory, (page ~ '.form.decisionsSatisfactory'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.contacts') | trans }}</h3>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.consultationsSatisfactory, (page ~ '.form.consultationsSatisfactory'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.visitsAndCare') | trans }}</h3>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.careArrangements, (page ~ '.form.careArrangements'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>

        <details class="push--bottom">
            <summary>
                <span class="summary">View deputy's responses</span>
            </summary>
            <div class="panel panel-border-narrow">
                <div>

                    {# Questions and answers table #}
                    {% include 'AppBundle:Report/VisitsCare:_answers.html.twig' %}

                    <table class="check-your-answers columns-2 push--bottom">
                        <thead>
                            <tr>
                                <th>{{ 'question' | trans({}, 'common') }}</th>
                                <th>{{ 'answer' | trans({}, 'common') }}</th>
                                <th>
                                    <span class="visually-hidden">{{ 'actions' | trans({}, 'common') }}</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            {# step 1 #}
                            <tr>
                                <td>
                                    {{ 'form.doYouLiveWithClient.label' | trans(transOptions, 'report-visits-care') }}
                                </td>
                                <td>
                                    {{ report.visitsCare.doYouLiveWithClient | capitalize }}
                                </td>
                            </tr>
                            {% if report.visitsCare.doYouLiveWithClient == 'no' %}
                                <tr>
                                    <td>{{ 'form.howOftenDoYouContactClient.labelShort' | trans(transOptions, 'report-visits-care') }}</td>
                                    <td>{{ report.visitsCare.howOftenDoYouContactClient | nl2br }}</td>
                                </tr>
                            {% endif %}
                            {# step 2 #}
                            <tr>
                                <td>
                                    {{ 'form.doesClientReceivePaidCare.label' | trans(transOptions, 'report-visits-care') }}
                                </td>
                                <td>
                                    {{ report.visitsCare.doesClientReceivePaidCare | capitalize }}
                                </td>
                            </tr>
                            {% if report.visitsCare.doesClientReceivePaidCare == 'yes' %}
                                <tr>
                                    <td>
                                        {{ 'form.howIsCareFunded.label' | trans(transOptions, 'report-visits-care') }}
                                    </td>
                                    <td>
                                        {{ ('form.howIsCareFunded.choices.' ~ report.visitsCare.howIsCareFunded) | trans(transOptions, 'report-visits-care') }}
                                    </td>
                                </tr>
                            {% endif %}
                            {# step 3 #}
                            <tr>
                                <td>
                                    {{ 'form.whoIsDoingTheCaring.label' | trans(transOptions, 'report-visits-care') }}
                                </td>
                                <td>
                                    {{ report.visitsCare.whoIsDoingTheCaring | nl2br }}
                                </td>
                            </tr>
                            {# step 4 #}
                            <tr>
                                <td>
                                    {{ 'form.doesClientHaveACarePlan.label' | trans(transOptions, 'report-visits-care') }}
                                </td>
                                <td>
                                    {{ report.visitsCare.doesClientHaveACarePlan | capitalize }}
                                </td>
                            </tr>
                            {% if report.visitsCare.doesClientHaveACarePlan == 'yes' %}
                                <tr>
                                    <td>
                                        {{ 'form.whenWasCarePlanLastReviewed.label' | trans(transOptions, 'report-visits-care') }}
                                    </td>
                                    <td>
                                        {{ report.visitsCare.whenWasCarePlanLastReviewed | date('F Y') }}
                                    </td>
                                </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </details>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.assetsAndDebts') | trans }}</h3>

    <div class="form-section form-section--meta-cancel">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.assetsDeclaredAndManaged, (page ~ '.form.assetsDeclaredAndManaged'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.debtsManaged, (page ~ '.form.debtsManaged'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.money') | trans }}</h3>

    <div class="form-section underline form-section--meta-cancel">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.openClosingBalancesMatch, (page ~ '.form.openClosingBalancesMatch'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>

    <div class="form-section underline form-section--meta-cancel">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.accountsBalance, (page ~ '.form.accountsBalance'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>

        <details class="push--bottom">
            <summary>
                <span class="summary">View accounts balance summary</span>
            </summary>
            <div class="panel panel-border-narrow">
                <div>
                    <h3 class="heading-medium">Balance after incoming and outgoing payments</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Section</th>
                                <th class="numeric">In</th>
                                <th class="numeric">Out</th>
                                <th class="numeric">Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- SOME STARTED -->
                            <tr>
                                <td class="width-half">Accounts opening balance (4 March 2011)</td>
                                <td colspan="2"></td>
                                <td class="numeric">£300.00</td>
                            </tr>
                            <tr>
                                <td>Deputy expenses</td>
                                <td></td>
                                <td class="numeric">£100.00</td>
                                <td class="numeric">£200.00</td>
                            </tr>
                            <tr>
                                <td>Gifts</td>
                                <td></td>
                                <td class="numeric">£100.00</td>
                                <td class="numeric">£100.00</td>
                            </tr>
                            <tr>
                                <td>Money in</td>
                                <td class="numeric">£100.00</td>
                                <td></td>
                                <td class="numeric">£200.00</td>
                            </tr>
                            <tr>
                                <td>Money out</td>
                                <td></td>
                                <td class="numeric">£100.00</td>
                                <td class="numeric">£100.00</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr id="calculated_balance_foot">
                                <td colspan="3"><span class="bold">Report closing balance after incoming and outgoing payments</span></td>
                                <td class="numeric bold"><span class="bold" id="calculated_balance_foot_value">£100.00</span></td>
                            </tr>
                        </tfoot>
                    </table>

                    <h3 class="heading-medium">Balance differences</h3>
                    <table class="push--ends" id="calculated_balance_table">
                        <thead class="visually-hidden">
                            <tr>
                                <th>Section</th>
                                <th colspan="2"></th>
                                <th class="numeric">Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="width-half">Accounts closing balance (3 March 2012)</td>
                                <td colspan="2"></td>
                                <td class="numeric">£850.00</td>
                            </tr>
                            <tr>
                                <td>Report closing balance (see above)</td>
                                <td colspan="2"></td>
                                <td class="numeric">£100.00</td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>
                                <td colspan="3"><span class="bold">Difference</span></td>
                                <td class="numeric bold"><span class="bold">£750.00</span></td>
                            </tr>
                        </tfoot>
                    </table>

                    <h3 class="heading-medium">Explanation</h3>
                    <table class="check-your-answers columns-2 push--bottom">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Answer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="behat-region-expect-financial-decision">
                                <td>Explanation</td>
                                <td>Nobis at eos odit. In totam cupiditate corrupti aut reprehenderit ea repudiandae. Aut enim assumenda molestiae.<br>Quia facere ut commodi expedita reprehenderit quaerat totam. Nisi dolor asperiores consequatur minus. A ipsa nam sit iste in assumenda qui assumenda. Quia dolores facere dolores. Ad voluptates voluptas at aut.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </details>

    </div>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.moneyMovementsAcceptable, (page ~ '.form.moneyMovementsAcceptable'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.bonds') | trans }}</h3>

    <div class="form-section form-section--meta-cancel">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.bondAdequate, (page ~ '.form.bondAdequate'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.bondOrderMatchCasrec, (page ~ '.form.bondOrderMatchCasrec'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.nextPeriod') | trans }}</h3>

    <div class="form-section underline form-section--meta-cancel">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.futureSignificantFinancialDecisions, (page ~ '.form.futureSignificantFinancialDecisions'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>

        <details class="push--bottom">
            <summary>
                <span class="summary">View deputy's response</span>
            </summary>
            <div class="panel panel-border-narrow">
                <div>
                    <table class="check-your-answers columns-2 push--bottom">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Answer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="behat-region-expect-financial-decision">
                                <td>Do you expect to make any significant financial decisions on John's behalf in the next 12 months?</td>
                                <td>Yes</td>
                            </tr>
                            <tr class="behat-region-expect-financial-decision-details">
                                <td>Please give us details about your decisions</td>
                                <td>Nobis at eos odit. In totam cupiditate corrupti aut reprehenderit ea repudiandae. Aut enim assumenda molestiae.<br>Quia facere ut commodi expedita reprehenderit quaerat totam. Nisi dolor asperiores consequatur minus. A ipsa nam sit iste in assumenda qui assumenda. Quia dolores facere dolores. Ad voluptates voluptas at aut.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </details>
    </div>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.hasDeputyRaisedConcerns, (page ~ '.form.hasDeputyRaisedConcerns'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>

        <details class="push--bottom">
            <summary>
                <span class="summary">View deputy's response</span>
            </summary>
            <div class="panel panel-border-narrow">
                <div>
                    <table class="check-your-answers columns-2 push--bottom">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Answer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="behat-region-expect-financial-decision">
                                <td>Do you have any concerns about your deputyship?</td>
                                <td>No</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </details>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.heading.declaration') | trans }}</h3>

    <div class="form-section form-section--meta-cancel last">
        <div class="form-group-meta"></div>
        <div class="form-group-outer">
            {{ form_checkbox_group(form.caseWorkerSatisified, (page ~ '.form.caseWorkerSatisified'), {
                'fieldSetClass' : 'inline'
            }) }}
        </div>

        <details class="push--bottom">
            <summary>
                <span class="summary">View deputy's declaration</span>
            </summary>
            <div class="panel panel-border-narrow">
                <div>
                    <table class="check-your-answers columns-2 push--bottom">
                        <thead>
                            <tr>
                                <th>Question</th>
                                <th>Answer</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="behat-region-expect-financial-decision">
                                <td>Declaration</td>
                                <td>I am the only deputy</td>
                            </tr>
                            <tr class="behat-region-expect-financial-decision">
                                <td>Declaration time</td>
                                <td>14:00 23/05/2018</td>
                            </tr>
                            <tr class="behat-region-expect-financial-decision">
                                <td>Deputy name</td>
                                <td>David Spencer</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </details>
    </div>


    <h3 class="heading-medium underline">{{ (page ~ '.lodgingSummary.heading') | trans }}</h3>

    <ul class="list list-bullet text">
        <li>{{ (page ~ '.lodgingSummary.listItem1') | trans }}</li>
        <li>{{ (page ~ '.lodgingSummary.listItem2') | trans }}</li>
        <li>{{ (page ~ '.lodgingSummary.listItem3') | trans }}</li>
        <li>{{ (page ~ '.lodgingSummary.listItem4') | trans }}</li>
    </ul>

    <div class="form-section push--bottom">
        {{ form_checkbox_group(form.finalDecision, (page ~ '.form.finalDecision'), {
            'legendClass': 'bold'
        }) }}
    </div>

    <div class="form-section push--bottom">
        {{ form_input(form.lodgingSummary, 'checklistPage.form.lodgingSummary') }}
    </div>


    <h3 class="heading-medium underline" id="furtherInformation">{{ (page ~ '.furtherInfo.heading') | trans }}</h3>

    <p class="text">{{ (page ~ '.furtherInfo.para') | trans }}</p>

    <table class="push--bottom">
        <thead>
            <tr>
                <th>Information provided</th>
                <th class="width-fifth">Saved by</th>
                <th class="numeric">Date saved</th>
            </tr>
        </thead>
        <tbody>
        {% if checklist.checklistInformation is not empty %}
            {% set counter = 1 %}
            {% for info in checklist.checklistInformation %}

            <tr>
                <td class="behat-region-information-{{ counter }}">{{ info.information | nl2br }}</td>
                <td class="behat-region-information-created-by-{{ counter }} align--top">{{ info.createdBy.fullname }}, {{ info.createdBy.roleFullName }}</td>
                <td class="behat-region-created-on-{{ counter }} numeric no-wrap align--top">{{ info.createdOn | date("j F Y") }}</td>
            </tr>
                {% set counter = counter + 1 %}
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="3">No information received.</td>
            </tr>
        {% endif %}
        </tbody>
    </table>

    <div class="form-section push-double--bottom">
        {{ form_input(form.furtherInformationReceived, 'checklistPage.form.furtherInformationReceived', {
            'formGroupClass': 'explanation',
        }) }}
        {{ form_submit(form.saveFurtherInformation,'checklistPage.form.saveFurtherInformation', {
            'buttonClass': 'button-secondary behat-link-save-further-information'
        }) }}
    </div>

    <div class="form-section">
        {{ form_submit(form.save,'checklistPage.form.save', {
            'buttonClass': 'button-secondary push-half--right behat-link-save-progress'
        }) }}

        {{ form_submit(form.submitAndDownload,'checklistPage.form.submitAndDownload', {
            'buttonClass': 'behat-link-submit-and-download'
        }) }}

        <a href="{{ path('admin_client_details', {'id': report.client.id}) }}" class="button-link">{{ 'cancel' | trans({}, 'common') }}</a>
    </div>


    {{ form_end(form) }}

{% endblock %}
