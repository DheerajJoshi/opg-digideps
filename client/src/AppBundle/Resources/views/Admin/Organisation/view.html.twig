{% extends 'AppBundle:Layouts:application.html.twig' %}
{% import 'AppBundle:Macros:macros.html.twig' as macros %}

{% trans_default_domain "admin-organisations" %}
{% set page = 'viewPage' %}

{% block htmlTitle %}{{ (page ~ '.htmlTitle') | trans }}{% endblock %}
{% block pageTitle %}{{ organisation.name }}{% endblock %}

{% block supportTitleTop %}
    <span class="govuk-caption-xl">{{ (page ~ '.supportTitle') | trans }}</span>
{% endblock %}

{% block breadcrumbs %}
    {{ macros.breadcrumbsArray([
        { href: url('admin_homepage'), text: 'Admin' },
        { href: url('admin_organisation_homepage'), text: 'Organisations' },
        { text: organisation.name }
    ]) }}
{% endblock %}

{% block pageContent %}

    <a href="{{ url('admin_organisation_member_add', { id: organisation.id }) }}" role="button" data-module="govuk-button" class="govuk-button govuk-button--secondary">
        {{ (page ~ '.addMember') | trans }}
    </a>

    <table class="govuk-table">
        <caption class="govuk-table__caption">
            {{ (page ~ '.users.caption') | trans }}
        </caption>

        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th class="govuk-table__header" scope="col">{{ (page ~ '.users.name') | trans }}</th>
                <th class="govuk-table__header" scope="col">{{ (page ~ '.users.emailAddress') | trans }}</th>
                <th class="govuk-table__header" scope="col">{{ (page ~ '.users.active') | trans }}</th>
                <th class="govuk-table__header" scope="col">
                    <span class="govuk-visually-hidden">{{ 'actions' | trans({}, 'common') }}</span>
                </th>
            </tr>
        </thead>

        <tbody class="govuk-table__body">
            {% for user in organisation.users %}
                <tr class="govuk-table__row behat-region-org-{{ user.fullName | behat_namify }}">
                    <td class="govuk-table__cell">
                        <a class="govuk-link" href="{{ url('admin_editUser', { filter: user.id }) }}">
                            {{ user.fullName }}
                        </a>
                    </td>
                    <td class="govuk-table__cell">
                        {{ user.email }}
                    </td>
                    <td class="govuk-table__cell">
                        {{ (user.active ? 'yes' : 'no') | trans({}, 'common') }}
                    </td>
                    <td class="govuk-table__cell govuk-table__cell--numeric">
                        <a class="govuk-link behat-link-delete" href="{{ url('admin_organisation_member_delete', { id: organisation.id, userId: user.id }) }}">
                            {{ 'remove' | trans({}, 'common') }}
                        </a>
                    </td>
                </tr>
            {% else %}
                <tr class="govuk-table__row">
                    <td colspan="4" class="govuk-table__cell text--center">
                        {{ (page ~ '.noMembers') | trans }}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <table class="govuk-table">
        <caption class="govuk-table__caption">
            {{ (page ~ '.clients.caption') | trans }}
        </caption>

        <thead class="govuk-table__head">
            <tr class="govuk-table__row">
                <th class="govuk-table__header" scope="col">{{ (page ~ '.clients.caseNumber') | trans }}</th>
                <th class="govuk-table__header" scope="col">{{ (page ~ '.clients.name') | trans }}</th>
                <th class="govuk-table__header" scope="col">{{ (page ~ '.clients.reportCount') | trans }}</th>
            </tr>
        </thead>

        <tbody class="govuk-table__body">
            {% for client in organisation.clients %}
                <tr class="govuk-table__row behat-region-org-{{ client.caseNumber | behat_namify }}">
                    <td class="govuk-table__cell">
                        <a class="govuk-link" href="{{ url('admin_client_details', { id: client.id }) }}">
                            {{ client.caseNumber }}
                        </a>
                    </td>
                    <td class="govuk-table__cell">
                        {{ client.fullName }}
                    </td>
                    <td class="govuk-table__cell">
                        {{ client.totalReportCount }}
                    </td>
                </tr>
            {% else %}
                <tr class="govuk-table__row">
                    <td colspan="3" class="govuk-table__cell text--center">
                        {{ (page ~ '.noClients') | trans }}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
