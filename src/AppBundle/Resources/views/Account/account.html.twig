{% extends 'AppBundle:Components/Page:page-report.html.twig' %}
{% set translationDomain = "report-account" %}
{% trans_default_domain translationDomain %}

{% set URL = app.request.requestUri %}
{% set queryString = URL | split('?') %}

{% set accordionLinks = accordionLinks({
  clickedPanel: app.request.get('action'),
  bothOpenHref: "money-both", 
  allClosedHref: "list", 
  firstPanelHref: "money-in", 
  secondPanelHref: "money-out"
}) %}

{% set moneyInTotal = 0 %}
{% set moneyOutTotal = 0 %}

{% set breadCrumb = [
    {
        'label': 'Accounts',
        'href': '../accounts'
    },
    {
        'label': account.bank
    }
] %}


{% block pageTitle %}{{ 'page.htmlTitle' | trans({'%accountName%': account.bank}) }} {% endblock %}
{% block contentClass %}{{ parent() }} js-report-accounts-input{% endblock %}
{% block title %}{{ 'page.htmlTitle' | trans }}{% endblock %}

{% block pageNavigation %}
    {% include 'AppBundle:Components/Navigation:_report-nav.html.twig' with { 'report': report, tab: 'tab-accounts'} %}
{% endblock %}

{% block pageBody %}


    {% include 'AppBundle:Components/Navigation:_bread-crumb.html.twig' with {
    breadCrumb: breadCrumb
    } %}

    {% include 'AppBundle:Account:_account-header.html.twig' %}

    {#
        * Finish breadcrumb
    #}

    {% include 'AppBundle:Components/Page:_page-section-warning.html.twig' with {
    transDomain: translationDomain,
    pageSectionWarning: 'page.pageSectionWarning'
    } %}

    {% block validationSummary %}
        {{ form_errors_list(form) }}
    {% endblock %}

    {{ form_start(form, {attr: {novalidate: 'novalidate' }}) }}

    {{ form_row(form.id) }}

    <div class="account-transactions account-transactions__header">
        <dl class="account-transactions__total-balance">
            <dt class="account-transactions__total-balance-label">Total balance</dt>
            <dd class="account-transactions__total-balance-total">
                £{{ account.moneyTotal | number_format(2, '.', ',') }}</dd>
        </dl>
    </div>

    <div class="account-transactions account-transactions__accordion">
      
        {% include 'AppBundle:Account:_accountTransaction.html.twig' with {
        legend: 'moneyIn.legend' | trans,
        openPanel: accordionLinks.first.open,
        summaryHref: path('account', {action: accordionLinks.first.href, reportId: report.id, accountId: account.id}),
        elements: form.moneyIn,
        section: 'moneyIn',
        transactionTotal: moneyInTotal
        } %}


        {% include 'AppBundle:Account:_accountTransaction.html.twig' with {
        legend: 'moneyOut.legend' | trans,
        openPanel: accordionLinks.second.open,
        summaryHref: path('account', {action: accordionLinks.second.href, reportId: report.id, accountId: account.id}),
        elements: form.moneyOut,
        section: 'moneyOut',
        transactionTotal: moneyOutTotal
        } %}

    </div>

    <div class="account-transactions account-transactions__footer">
        <ul class="account-transactions__total-balance">
            <li class="account-transactions__total-balance-label">Total balance</li>
            <li class="account-transactions__total-balance-total">
                £{{ account.moneyTotal | number_format(2, '.', ',') }}</li>
        </ul>
    </div>

    {% include 'AppBundle:Components/ButtonBar:_start.html.twig' %}
    {{ form_submit(form.save, 'save', {'buttonClass': 'behat-link-save'}) }}
    {% include 'AppBundle:Components/ButtonBar:_end.html.twig' %}

    {{ form_end(form) }}

{% endblock %}
