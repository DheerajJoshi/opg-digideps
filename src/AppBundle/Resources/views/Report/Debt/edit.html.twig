{% extends 'AppBundle:Layouts:application_new.html.twig' %}

{% import 'AppBundle:Macros:macros.html.twig' as macros %}

{% set translationDomain = "report-debts" %}
{% trans_default_domain translationDomain %}
{% set transOptions = {'%client%': report.client.firstname} %}

{% block htmlTitle %}{{ 'page.htmlTitle' | trans(transOptions) }}{% endblock %}
{% block pageTitle %}{{ 'page.pageSectionTitle' | trans(transOptions) }}{% endblock %}

{% block breadcrumbs %}
    {{ macros.breadcrumbs(report) }}
{% endblock %}

{% block pageContent %}

    <h3 class="heading-medium flush--top">{{ 'page.heading' | trans({'%client%': report.client.firstname}, translationDomain) }}</h3>

    {{ form_errors_list(form) }}

    {{ form_start(form, {attr: {novalidate: 'novalidate', class: 'debts-form' }}) }}

    <div class="sections hidden-detail expanding-transaction-table no-margin-top" id="debts-sections-list">
        <p class="page-section-description">{{ 'page.pageSectionDescription' | trans({'%client%': report.client.firstname}, translationDomain) }}</p>
        <div class="section no-border-bottom form-horizontal">
            <div class="detail transactions detail-view">
                {% for debt in form.debts %}
                    <div class="transaction {{ debt.moreDetails is defined ? ' expand-more-details ' : '' }}">
                        {{ form_row(debt.debtTypeId) }}
                        {{ form_input(debt.amount, 'amount', {
                            'inputPrefix' : '£',
                            'inputClass' : 'form-control__number transaction-value',
                            'labelText': ('form.entries.' ~ debt.debtTypeId.vars.value ~ '.label') | trans,
                            'formGroupClass': ' form-group-value'
                        }) }}

                        {% if debt.moreDetails is defined %}
                            {{ form_input(debt.moreDetails, 'moreDetails', {
                                'labelText': ('form.entries.' ~ debt.debtTypeId.vars.value ~ '.moreInformations') | trans,
                                'formGroupClass': 'form-group-combo-description',
                                'inputClass': ' transaction-more-details'
                            }) }}
                        {% endif %}
                    </div>
                {% endfor %}
                <div class="sub-total hidden">
                    Total debts
                    :£<span class="value">{{ report.debtsTotalAmount | money_format }}</span>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function () {
            // client has debt radio box hide/show debts list
            new GOVUK.SelectionButtons('.form-group__checkbox-group :radio');

            // auto format currencies
            $('input.transaction-value').on('blur', function (event) {
                GOVUK.formatCurrency(event.target);
            });

            new GOVUK.ExpandingMoreDetails('.expand-more-details');
        });
    </script>

    <div id="save-debts" class="save-section no-margin">
        <div class="save-bar button-bar">
            {{ form_submit(form.save,'save', { 'buttonClass': '' }) }}
        </div>
    </div>

    {% include 'AppBundle:Components/ButtonBar:_save_bar.html.twig' with {
    transDomain: translationDomain,
    showDelete: false,
    showCancel: false,
    section: 'account',
    } %}

    {{ form_end(form) }}

    {% include 'AppBundle:Components:nextprevious.html.twig' with {
    'previousLink': path('assets' , {'reportId': report.id }),
    'previousLabel': 'Assets',
    'nextLink': path("actions" , {'reportId': report.id }),
    'nextLabel': 'Actions'
    } %}

{% endblock %}