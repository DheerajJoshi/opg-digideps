{% set translationDomain = "report-accounts" %}
{% trans_default_domain translationDomain %}

<ul class="behat-region-list-accounts report-list report-list--accounts">
    {% for account in accounts %}
        
        {# define warning message along with the account and the link (that changes depending on the warning) #}
        {% set linkToAccountPage = path('account', {'reportId': report.id, 'accountId': account.id}) %}
        {% set warningMessage = null %}    
        {% if report.isDue() and account.needsClosingBalanceData() %}
          {% if account.getCountValidTotals() > 0 %}
              {% set warningMessage = 'listing.addClosingBalanceWarning' %}    
              {% set linkToAccountPage = linkToAccountPage ~ '#closing-balance' %}
            {% else %}
              {% set warningMessage = 'listing.addTotalsWarning' %}    
              {% set linkToAccountPage = path('account', {'reportId': report.id, 'accountId': account.id, 'action': 'money-both'}) ~ '#pageBody' %}
          {% endif %}
        {% endif %}
        
        <li class="report-list__item">
            <dl class="report-list__item-fields">
                <div class="report-list__item-fields-col-bank">
                    <dt class="visuallyhidden">{{ 'listing.bank' | trans }}</dt>
                    <dd class="report-list__item-fields-description">
                        <h3>
                            {% if report.isDue() and account.closingBalance is null %}
                                <a href="{{ linkToAccountPage }}"
                                   class="behat-link-account-{{ account.accountNumber }}">
                                    {{ account.bank }}
                                </a>
                            {% else %}
                                <a href="{{ linkToAccountPage }}" class="behat-link-account-{{ account.accountNumber }}">
                                    {{ account.bank }}
                                </a>
                            {% endif %}
                        </h3>
                    </dd>
                </div>
                <div class="report-list__item-fields-col-acc-num">
                    <dt class="visuallyhidden">{{ 'listing.accountNumber' | trans }}</dt>
                    <dd class="report-list__item-fields-description report-list__item-fields-description--normal">&bull;&bull;&bull;&bull;{{ account.accountNumber }}</dd>
                </div>
                <div class="report-list__item-fields-col-info">
                    {% if account.closingBalance %}
                        <div>
                            <dt class="report-list__item-fields-term">{{ 'listing.closingBalance' | trans }}</dt>
                            <dd class="report-list__item-fields-description report-list__item-fields-description--normal behat-region-account-{{ account.id }}-closing-balance">{{ account.closingBalance | number_format(2, '.', ',') }}</dd>
                        </div>
                    {% else %}
                        <div>
                            <dt class="report-list__item-fields-term">{{ 'listing.totalBalance' | trans }}</dt>
                            <dd class="report-list__item-fields-description report-list__item-fields-description--normal">
                                {{ 'listing.currencySymbol' | trans }}{{ account.moneyTotal | number_format(2, '.', ',') }}</dd>
                        </div>
                    {% endif %}
                    {% if account.closingDate %}
                        <div>
                            <dt class="report-list__item-fields-term">{{ 'listing.closingDate' | trans }}</dt>
                            <dd class="report-list__item-fields-description report-list__item-fields-description--normal behat-region-account-{{ account.id }}-closing-date">{{ account.closingDate | date("d/m/Y") }}</dd>
                        </div>
                    {% elseif account.lastEdit %}
                        <div>
                            <dt class="report-list__item-fields-term">{{ 'listing.lastEdited' | trans }}</dt>
                            <dd class="report-list__item-fields-description report-list__item-fields-description--normal">{{ account.lastEdit | date("d/m/Y") }}</dd>
                        </div>
                    {% else %}
                        <div>
                            <dt class="report-list__item-fields-term">{{ 'listing.created' | trans }}</dt>
                            <dd class="report-list__item-fields-description report-list__item-fields-description--normal">{{ account.createdAt | date("d/m/Y") }}</dd>
                        </div>
                    {% endif %}
                </div>
                  {% if warningMessage %}
                    {% include 'AppBundle:Components/Page:_page-section-warning.html.twig' with {
                      transDomain: translationDomain,
                      pageSectionWarning: warningMessage | trans,
                      iconClass: 'icon icon__notification behat-region-account-' ~ account.accountNumber ~ '-warning'
                    } %}
                  {% endif %}
            </dl>

        </li>
    {% endfor %}
</ul>
