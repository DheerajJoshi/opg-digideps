{% extends 'AppBundle:Layouts:application.html.twig' %}

{% import 'AppBundle:Macros:macros.html.twig' as macros %}

{% set translationDomain = "report-documents" %}
{% set page = "reportDocuments" %}

{% trans_default_domain translationDomain %}

{# Page Titles #}
{% block htmlTitle %}{{ 'htmlTitle' | trans }}{% endblock %}
{% block pageTitle %}{{ 'pageTitle' | trans }}{% endblock %}
{% block pageTitleClass %}heading-large{% endblock %}

{# Breadcrumbs #}
{% block breadcrumbs %}{{ macros.breadcrumbs(report) }}{% endblock %}

{% block supportTitleTop %}
    <span class="heading-secondary">{{ report.client.fullname }}</span>
{% endblock %}

{% block supportTitleBottom %}
    <span class="heading-secondary">Reporting period: {{ report.period }}</span>
{% endblock %}

{% block pageContent %}

    <p class="text">{{ (page ~ '.supportText') | trans }}</p>

    <h2 class="heading-medium">{{ (page ~ '.attachDocuments') | trans }}</h2>

    {{ form_start(form, {'attr': {'id': 'upload_form'}}) }}
    {{ form_input(form.file,'form.file', {
        'labelRaw': true,
        'labelText':  'form.attachAFile' | trans ,
        'inputClass': 'no-border',
        'hintText': 'form.acceptedFileTypes' | trans}) }}
    {{ form_submit(form.save, '', {'labelText': 'form.attachDocument' | trans}) }}

    <a href=" {{ backLink }} " class="button-link">{{ 'cancel' | trans({}, 'common') }}</a>

    {{ form_end(form) }}


    {#<h2 class="heading-medium">Uploading progress</h2>#}
    {#<p>Please wait while your document is being uploaded.</p>#}
    {#<progress max="100" value="24" style="width: 50%"></progress>#}

    {% include 'AppBundle:Report/Document:_documentList.html.twig'  with {
    'translationDomain': translationDomain,
    'page' : page
    } %}

    {% if step %}
        <a href="{{ path('report_documents_summary', {'reportId':report.id, 'step':3, 'from':'report_documents'}) }}" class="button">Save and continue</a>
    {% endif %}

    <script>
        $(document).ready(function () {
            $('#upload_form').submit(function (e) {
                e.preventDefault();
                var fileElement = $('#report_document_upload_file');

                //check whether browser fully supports all File API
                if (window.File && window.FileReader && window.FileList && window.Blob && fileElement[0].files.length > 0) {
                    var fsize = fileElement[0].files[0].size;
                    if (fsize > {{ 15 * 1024 * 1024 }} ) {
                        window.location = '{{ path('report_documents', {'reportId': report.id, 'error': 'tooBig'}) }}';
                        return;
                    }
                }

                this.submit();
            });
        });
    </script>


{% endblock %}
